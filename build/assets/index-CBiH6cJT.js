import{q as y,d as g,i as E,A as l,t as S,v as N,b as nt,j as n,Q as ot,m as rt,r as p,x as ct,n as dt,V as it,I as lt,B as T,P as ut,C as mt}from"./index-bcifMYEQ.js";import{M as Ct}from"./modify-card-D-N1kzU2.js";import{a as ft,b as pt,D as xt,S as vt,d as It,e as ht,f as k,c as jt}from"./popover-BSl-E8wt.js";import{C as z,T as yt}from"./column-container-C8j73vUF.js";import{u as gt}from"./use-create-card-BZGlKh3b.js";import"./use-search-params-Bty0Q4Dj.js";import"./Table-DqxhufFh.js";import"./index-DMQ_vExv.js";import"./index-DazJ7QXT.js";import"./text-BZj7_MT7.js";const St=async(a,s)=>{const e={name:s.name};return await S.post(`/projects/${a}`,e)},Lt=()=>{const a=y(),s=N(a);return g({mutationFn:e=>St(a,e),onSuccess(e){E(e.status)&&(l.success("List card created successfully"),s())},onError:e=>{l.error(e.message)}})},bt=async(a,s)=>await S.put(`/projects/${a}/${s.id}`,s),kt=()=>{const a=y(),s=N(a);return g({mutationFn:e=>bt(a,e),onSuccess(e){E(e.status)?(l.success("List card update successfully"),s()):l.error("Failed to update list card")},onError:e=>{l.error(e.message)}})},At=async(a,s)=>{await S.post(`/projects/${a}/move/listcard`,{ids:s.map(e=>e.id)})},Pt=()=>{const a=y();return g({mutationFn:s=>At(a,s),onSuccess(){l.success("Column moved successfully")}})},wt=async(a,s,e)=>{const C=s.map(u=>({listCardId:u.id,cardIds:e.filter(i=>i.listCardId===u.id).map(i=>i.id)}));return S.post(`/projects/${a}/move/card`,{ids:C})},Mt=()=>{const a=y();return g({mutationFn:({columns:s,cards:e})=>wt(a,s,e),onSuccess(){l.success("Card moved successfully")}})},Tt=async(a,s)=>await S.delete(`/projects/${a}/${s}`),Et=()=>{const a=y(),s=N(a);return g({mutationFn:e=>Tt(a,e),onSuccess(e){E(e.status)?(s(),l.success("List card deleted successfully")):l.error("Failed to delete list card")},onError(e){l.error(e.message)}})};function Nt(){const{modal:a}=nt.useApp(),s=Et();return async C=>{const u=a.confirm({title:"Remove List Card",content:"Are you sure you want to remove this this card?",cancelText:"Cancel",okText:"Remove",okType:"danger",icon:n.jsx(ot,{color:"red",className:"mr-2 mt-0.5 h-5 w-5"})});return u.update({okButtonProps:{loading:s.isPending},cancelButtonProps:{disabled:s.isPending}}),await u.then(i=>(i&&s.mutate(C),i),()=>{})}}const Gt=()=>{const[a,s]=rt(!1),e=t=>{s(t)},[C,u]=p.useState(""),[i,D]=p.useState(null),[F,$]=p.useState(null),[f,O]=p.useState([]),[c,B]=p.useState([]),{data:o,isLoading:V}=ct(),{mutate:U}=Lt(),{mutate:q}=kt(),{mutate:G}=gt(),{mutate:H}=Pt(),{mutate:Q}=Mt(),X=Nt(),J=p.useMemo(()=>f.map(t=>t.id),[f]),K=ft(pt(jt,{activationConstraint:{distance:10}}));p.useEffect(()=>{const t=[];o==null||o.listCards.forEach(r=>{r.cards.forEach(d=>{t.push({...d,listCardId:r.id})})}),o!=null&&o.listCards&&O(o==null?void 0:o.listCards),B(t)},[o]);const R=()=>{U({name:C}),s(!1)},W=t=>{q(t)},Y=t=>{X(t)},Z=(t,r)=>{G({columnId:t,card:r})},_=t=>{H(t),O(t)},A=t=>{Q({columns:f,cards:t}),B(t)},tt=dt(t=>t.theme.btnColor);return n.jsxs("div",{children:[n.jsxs(xt,{sensors:K,onDragStart:et,onDragEnd:st,onDragOver:at,children:[V?n.jsx(it.Page,{size:"full"}):n.jsx("div",{className:"inline-block min-h-screen px-6 ",children:n.jsxs("div",{className:"flex items-start gap-x-3",children:[n.jsx(vt,{items:J,children:f.map(t=>n.jsx(z,{column:t,cards:c.filter(r=>r.listCardId===t.id),updateColumn:W,deleteColumn:Y,createCard:Z},t.id))}),n.jsx(It,{visible:a,onOpenChange:e,content:n.jsxs("div",{className:"flex w-[250px] flex-col gap-4",children:[n.jsx(lt,{placeholder:"Enter list title",allowClear:!0,size:"large",className:"rounded text-sm font-semibold ",value:C,onChange:t=>u(t.target.value),onPressEnter:()=>{R(),u("")}}),n.jsxs("div",{className:"ml-auto flex items-center gap-x-2",children:[n.jsx(T,{onClick:()=>{R(),u("")},type:"text",style:{backgroundColor:tt,color:"#fff"},className:"rounded text-xs font-semibold text-white",children:"Add list"}),n.jsx(T,{type:"default",className:"w-16 rounded text-xs font-semibold",onClick:()=>e(!1),children:"Cancel"})]})]}),children:n.jsx(T,{icon:n.jsx(ut,{className:"h-4 w-4 opacity-65"}),size:"large",className:"flex w-[275px] items-center rounded-xl border-none bg-[#ffffff3d] text-sm font-semibold text-white",children:"Add new list"})})]})}),mt.createPortal(n.jsxs(ht,{children:[i&&n.jsx(z,{column:i,cards:c.filter(t=>t.listCardId===i.id)}),F&&n.jsx(yt,{card:F})]}),document.body)]}),(o==null?void 0:o.users)&&n.jsx(Ct,{members:o==null?void 0:o.users})]});function et(t){var r,d;if(((r=t.active.data.current)==null?void 0:r.type)==="Column"){D(t.active.data.current.column);return}if(((d=t.active.data.current)==null?void 0:d.type)==="Task"){$(t.active.data.current.task);return}}function st(t){var j;D(null),$(null);const{active:r,over:d}=t;if(!d)return;const x=r.id,v=d.id;if(x===v||!(((j=r.data.current)==null?void 0:j.type)==="Column"))return;const P=f.findIndex(I=>I.id===x),w=f.findIndex(I=>I.id===v),b=k(f,P,w);_(b)}function at(t){var b,j,I;const{active:r,over:d}=t;if(!d)return;const x=r.id,v=d.id;if(x===v)return;const L=((b=r.data.current)==null?void 0:b.type)==="Task",P=((j=d.data.current)==null?void 0:j.type)==="Task";if(!L)return;if(L&&P){const m=c.findIndex(M=>M.id===x),h=c.findIndex(M=>M.id===v);c[m].listCardId!=c[h].listCardId&&(c[m].listCardId=c[h].listCardId,A(k(c,m,h-1))),A(k(c,m,h))}const w=((I=d.data.current)==null?void 0:I.type)==="Column";if(L&&w){const m=c.findIndex(h=>h.id===x);c[m].listCardId=v.toString(),A(k(c,m,m))}}};export{Gt as default};
